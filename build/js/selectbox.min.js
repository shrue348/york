!function(e){e.fn.selectbox=function(){e(this).each(function(){function s(){var s=t.find("option"),o=s.filter(":selected"),l=s.filter(":first").text();o.length&&(l=o.text());var d="";for(i=0;i<s.length;i++){var n="",c=' class="disabled"',a=[];s.eq(i).hasClass("empty")&&a.push("empty"),s.eq(i).is(":selected")&&(a.push("selected"),a.push("sel")),a&&(n=' class="'+a.join(" ")+'"'),s.eq(i).is(":disabled")&&(n=c);var r=s.eq(i).text();r=r.replace(/ (\(\d+\))/," <span style='color: silver'>$1</span>"),d+="<li"+n+">"+r+"</li>"}var f=e('<span class="selectbox" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative;z-index:10000"><div class="text">'+l+'</div><b class="trigger"><i class="arrow"></i></b></div><div class="dropdown" style="position:absolute;z-index:9999;overflow:auto;overflow-x:hidden;list-style:none"><ul>'+d+"</ul></div></span>");t.before(f).css({position:"absolute",top:-9999});var h=f.find("div.select"),u=f.find("div.text"),p=f.find("div.dropdown"),v=p.find("li"),x=f.outerHeight();"auto"==p.css("left")&&p.css({left:0}),"auto"==p.css("top")&&p.css({top:x});var b=v.outerHeight(),g=p.css("top");p.hide(),h.click(function(){var s=f.offset().top,t=e(window).height()-x-(s-e(window).scrollTop());return 0>t||6*b>t?(p.height("auto").css({top:"auto",bottom:g}),p.outerHeight()>s-e(window).scrollTop()-20&&p.height(Math.floor((s-e(window).scrollTop()-20)/b)*b)):t>6*b&&(p.height("auto").css({bottom:"auto",top:g}),p.outerHeight()>t-20&&p.height(Math.floor((t-20)/b)*b)),e("span.selectbox").css({zIndex:1}).removeClass("focused"),f.css({zIndex:2}),p.is(":hidden")?(e("div.dropdown:visible").hide(),p.show()):p.hide(),!1}),v.hover(function(){e(this).siblings().removeClass("selected")});var w=v.filter(".selected").text();v.filter(":not(.disabled)").click(function(){var i=e(this).text();w!=i&&(e(this).addClass("selected sel").siblings().removeClass("selected sel"),s.removeAttr("selected").eq(e(this).index()).prop("selected",!0),w=i,u.text(i),t.change()),p.hide()}),p.mouseout(function(){p.find("li.sel").addClass("selected")}),t.focus(function(){e("span.selectbox").removeClass("focused"),f.addClass("focused")}).keyup(function(){u.text(s.filter(":selected").text()),v.removeClass("selected sel").eq(s.filter(":selected").index()).addClass("selected sel")}),e(document).on("click",function(s){e(s.target).parents().hasClass("selectbox")||(p.hide().find("li.sel").addClass("selected"),f.removeClass("focused"))})}var t=e(this);t.prev("span.selectbox").length<1&&(s(),t.on("refresh",function(){t.prev().remove(),s()}))})}}(jQuery);